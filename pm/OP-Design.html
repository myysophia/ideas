<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>OPåå°è¿è¥ç®¡ç†ç³»ç»ŸæŠ€æœ¯æ–¹æ¡ˆ</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<style>
  :root {
    --bg-color: #111827;
    --sidebar-bg: #1F2937;
    --text-color: #D1D5DB;
    --heading-color: #F9FAFB;
    --muted-color: #9CA3AF;
    --border-color: #374151;
    --brand-color: #818CF8;
    --code-bg: #1e293b;
    --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
  }
  html,body{margin:0; scroll-behavior:smooth;}
  body{
    font-family:"Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    background-color: var(--bg-color); color: var(--text-color); line-height:1.7;
    display: flex;
  }
  .sidebar {
    width: 280px; height: 100vh; position: sticky; top: 0;
    background-color: var(--sidebar-bg); border-right: 1px solid var(--border-color);
    overflow-y: auto; flex-shrink: 0;
  }
  .sidebar-header {
    padding: 24px; border-bottom: 1px solid var(--border-color);
  }
  .sidebar-header h1 {
    font-size: 20px; color: var(--heading-color); margin: 0;
  }
  .sidebar-nav { padding: 16px; }
  .sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
  .sidebar-nav li a {
    display: block; padding: 6px 16px; border-radius: 6px;
    color: var(--muted-color); text-decoration: none; font-size: 14px;
    transition: background-color 0.2s, color 0.2s;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .sidebar-nav li a:hover {
    background-color: rgba(255,255,255,0.05); color: var(--heading-color);
  }
  .sidebar-nav li a.active {
    background-color: var(--brand-color); color: #111827; font-weight: 600;
  }
  .sidebar-nav .sub-menu { padding-left: 16px; }
  .sidebar-nav .sub-menu a { font-size: 13px; }

  .main-content {
    flex-grow: 1; padding: 32px 48px; max-width: 900px; margin: 0 auto;
  }
  .page-header h1 {
    font-size: 42px; color: var(--heading-color); margin: 0 0 16px; line-height: 1.2;
  }
  section { margin-bottom: 48px; }
  h2 {
    font-size: 28px; color: var(--heading-color); border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px; margin: 40px 0 24px; display: flex; align-items: center; gap: 8px;
  }
  h2 .material-icons-outlined { color: var(--brand-color); }
  h3 { font-size: 22px; color: var(--heading-color); margin: 32px 0 16px; }
  h4 { font-size: 18px; color: var(--heading-color); margin: 24px 0 12px; border-left: 3px solid var(--brand-color); padding-left: 12px;}
  p, ul li, ol li { color: var(--text-color); font-size: 16px; }
  ul, ol { padding-left: 24px; }
  strong { color: var(--brand-color); font-weight: 500;}
  code:not(pre > code) {
    background-color: var(--code-bg); color: #A78BFA;
    padding: 2px 6px; border-radius: 4px; font-family: "Fira Code", monospace; font-size: 0.9em;
  }
  .code-wrapper { position: relative; margin: 20px 0; }
  pre {
    background-color: var(--code-bg); border: 1px solid var(--border-color);
    padding: 1.5em; border-radius: 8px; overflow-x: auto;
    box-shadow: var(--shadow);
  }
  pre code { font-family: "Fira Code", monospace; }
  .copy-button {
    position: absolute; top: 12px; right: 12px;
    background-color: #4B5563; color: white; border: none;
    padding: 6px 10px; border-radius: 6px; cursor: pointer;
    font-size: 12px; opacity: 0.7; transition: opacity 0.2s, background-color 0.2s;
  }
  .code-wrapper:hover .copy-button { opacity: 1; }
  .copy-button:hover { background-color: #6B7280; }
  
  .placeholder {
      border: 2px dashed var(--border-color); border-radius: 8px;
      padding: 24px; text-align: center; color: var(--muted-color);
      margin: 20px 0;
  }

  .timeline {
    list-style: none; padding: 0; position: relative;
  }
  .timeline::before {
    content: ''; position: absolute; top: 0; left: 12px;
    height: 100%; width: 2px; background-color: var(--border-color);
  }
  .timeline li {
    padding-left: 40px; margin-bottom: 24px; position: relative;
  }
  .timeline li::before {
    content: attr(data-stage); position: absolute; left: 0; top: 0;
    width: 24px; height: 24px; border-radius: 50%;
    background-color: var(--brand-color); color: #111827;
    display: flex; justify-content: center; align-items: center;
    font-weight: bold; font-size: 14px;
  }
  
  .file-tree {
    font-family: "Fira Code", monospace;
    font-size: 14px;
    background-color: var(--code-bg);
    border: 1px solid var(--border-color);
    padding: 20px;
    border-radius: 8px;
  }
  .file-tree ul {
    list-style: none;
    padding-left: 20px;
    margin: 0;
  }
  .file-tree li {
    position: relative;
    padding-left: 20px;
    line-height: 1.8;
  }
  .file-tree li::before {
    content: '';
    position: absolute;
    top: 14px;
    left: 0;
    border-left: 1px solid var(--muted-color);
    width: 10px;
    height: 100%;
  }
  .file-tree li:last-child::before {
    height: 0;
  }
  .file-tree li::after {
    content: '';
    position: absolute;
    top: 14px;
    left: 0;
    border-top: 1px solid var(--muted-color);
    width: 15px;
  }
  .file-tree .icon {
    margin-right: 8px;
    color: var(--muted-color);
  }
  .file-tree .folder { color: var(--brand-color); }
  .file-tree .file { color: var(--text-color); }
  .file-tree .comment { color: var(--muted-color); margin-left: 12px; }

  .action-buttons {
      position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 100;
  }
  .action-button {
      background-color: var(--sidebar-bg); color: var(--text-color); border: 1px solid var(--border-color);
      width: 48px; height: 48px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
      cursor: pointer; transition: all 0.2s ease; box-shadow: var(--shadow); text-decoration: none;
  }
  .action-button:hover { background-color: var(--brand-color); color: var(--bg-color); }
  
  .zoomable-image { cursor: zoom-in; }
  .image-zoom-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(17, 24, 39, 0.9);
    display: flex; justify-content: center; align-items: center;
    z-index: 1000;
    opacity: 0; visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    backdrop-filter: blur(5px);
  }
  .image-zoom-modal.visible { opacity: 1; visibility: visible; }
  .image-zoom-modal img {
    max-width: 90%; max-height: 90%;
    object-fit: contain;
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
    border-radius: 8px;
    transform: scale(0.95);
    transition: transform 0.3s ease;
  }
  .image-zoom-modal.visible img { transform: scale(1); }
  .image-zoom-modal .close-button {
    position: absolute; top: 20px; right: 20px;
    background-color: rgba(255, 255, 255, 0.1);
    color: white; border: none; width: 40px; height: 40px;
    border-radius: 50%; font-size: 24px; cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    transition: background-color 0.2s;
  }
  .image-zoom-modal .close-button:hover { background-color: rgba(255, 255, 255, 0.2); }

  @media (max-width: 1024px) {
    body { flex-direction: column; }
    .sidebar { width: 100%; height: auto; position: static; border-right: none; border-bottom: 1px solid var(--border-color); }
    .sidebar-nav { display: none; }
    .main-content { padding: 24px; }
    .page-header h1 { font-size: 32px; }
    h2 { font-size: 24px; }
  }
</style>
</head>
<body>

<aside class="sidebar">
  <div class="sidebar-header">
    <h1>OPåå°è¿è¥ç®¡ç†ç³»ç»Ÿ</h1>
    <p style="font-size:14px; color: var(--muted-color); margin: 4px 0 0;">æŠ€æœ¯æ–¹æ¡ˆ</p>
  </div>
  <nav class="sidebar-nav">
    <ul id="toc">
      <li><a href="#architecture"><strong>0. æ¶æ„å›¾</strong></a></li>
      <li><a href="#structure"><strong>1. é¡¹ç›®ç»“æ„è®¾è®¡</strong></a></li>
      <li><a href="#database"><strong>2. æ•°æ®åº“è¡¨è®¾è®¡</strong></a>
        <ul class="sub-menu">
            <li><a href="#db-ban">2.1 ç”¨æˆ·å°ç¦</a></li>
            <li><a href="#db-meme">2.2 Memeå®¡æ ¸</a></li>
            <li><a href="#db-post">2.3 Postæƒé‡</a></li>
            <li><a href="#db-support">2.4 å®¢æœæ”¯æŒ</a></li>
        </ul>
      </li>
      <li><a href="#backend"><strong>3. FastAPIåç«¯æ ¸å¿ƒ</strong></a>
        <ul class="sub-menu">
            <li><a href="#backend-deps">3.1 ä¸»è¦ä¾èµ–</a></li>
            <li><a href="#backend-services">3.2 æ ¸å¿ƒæœåŠ¡</a></li>
            <li><a href="#backend-ws">3.3 WebSocket</a></li>
        </ul>
      </li>
      <li><a href="#frontend"><strong>4. Reactå‰ç«¯æ ¸å¿ƒ</strong></a>
        <ul class="sub-menu">
            <li><a href="#frontend-stack">4.1 æŠ€æœ¯æ ˆ</a></li>
            <li><a href="#frontend-components">4.2 æ ¸å¿ƒé¡µé¢</a></li>
            <li><a href="#frontend-features">4.3 å…³é”®åŠŸèƒ½</a></li>
        </ul>
      </li>
      <li><a href="#openim"><strong>5. OpenIMé›†æˆ</strong></a></li>
      <li><a href="#security"><strong>6. å®‰å…¨ä¸æƒé™</strong></a></li>
      <li><a href="#deployment"><strong>7. éƒ¨ç½²å»ºè®®</strong></a></li>
      <li><a href="#priority"><strong>8. å¼€å‘ä¼˜å…ˆçº§</strong></a></li>
      <li><a href="#key-tech"><strong>9. å…³é”®æŠ€æœ¯ç‚¹</strong></a></li>
    </ul>
  </nav>
</aside>

<main class="main-content">
  <div class="page-header">
    <h1>OPåå°è¿è¥ç®¡ç†ç³»ç»ŸæŠ€æœ¯æ–¹æ¡ˆ</h1>
  </div>

  <section id="architecture">
    <h2><span class="material-icons-outlined">account_tree</span>0. æ¶æ„å›¾</h2>
    <div style="background:rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
        <img src="https://pub-10375556b89a45e0a56aff68854a2214.r2.dev/OP%E6%9E%B6%E6%9E%84%E5%9B%BE.svg" alt="OPåå°ç³»ç»Ÿæ¶æ„å›¾" style="width:100%; height:auto;" class="zoomable-image">
    </div>
  </section>

  <section id="structure">
    <h2><span class="material-icons-outlined">folder_special</span>1. é¡¹ç›®ç»“æ„è®¾è®¡</h2>
    <div class="file-tree">
        <ul>
            <li><span class="icon">ğŸ“</span><span class="folder">op-admin-system/</span>
                <ul>
                    <li><span class="icon">ğŸ“</span><span class="folder">backend/</span><span class="comment"># FastAPI åç«¯</span>
                        <ul>
                            <li><span class="icon">ğŸ“</span><span class="folder">app/</span>
                                <ul>
                                    <li><span class="icon">ğŸ“</span><span class="folder">api/</span><span class="comment"># APIè·¯ç”±</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">core/</span><span class="comment"># æ ¸å¿ƒé…ç½®</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">models/</span><span class="comment"># SQLAlchemyæ¨¡å‹</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">schemas/</span><span class="comment"># Pydantic schemas</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">services/</span><span class="comment"># ä¸šåŠ¡é€»è¾‘</span></li>
                                </ul>
                            </li>
                            <li><span class="icon">ğŸ“</span><span class="folder">alembic/</span><span class="comment"># æ•°æ®åº“è¿ç§»</span></li>
                            <li><span class="icon">ğŸ“„</span><span class="file">main.py</span></li>
                        </ul>
                    </li>
                    <li><span class="icon">ğŸ“</span><span class="folder">frontend/</span><span class="comment"># React å‰ç«¯</span>
                        <ul>
                           <li><span class="icon">ğŸ“</span><span class="folder">src/</span>
                                <ul>
                                    <li><span class="icon">ğŸ“</span><span class="folder">api/</span><span class="comment"># APIè°ƒç”¨å±‚</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">components/</span><span class="comment"># å…¬å…±ç»„ä»¶</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">pages/</span><span class="comment"># é¡µé¢</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">hooks/</span><span class="comment"># è‡ªå®šä¹‰hooks</span></li>
                                    <li><span class="icon">ğŸ“</span><span class="folder">store/</span><span class="comment"># çŠ¶æ€ç®¡ç†</span></li>
                                </ul>
                           </li>
                           <li><span class="icon">ğŸ“„</span><span class="file">package.json</span></li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
  </section>

  <section id="database">
    <h2><span class="material-icons-outlined">storage</span>2. æ•°æ®åº“è¡¨è®¾è®¡ (æ‰©å±•ç°æœ‰è¡¨)</h2>
    <div id="db-ban"><h4>2.1 ç”¨æˆ·å°ç¦ç›¸å…³è¡¨</h4><div class="placeholder">SQL DDL for Ban Records...</div></div>
    <div id="db-meme"><h4>2.2 Memeå®¡æ ¸ç›¸å…³è¡¨</h4><div class="placeholder">SQL DDL for Meme Review...</div></div>
    <div id="db-post"><h4>2.3 Postæƒé‡ç®¡ç†</h4><div class="placeholder">SQL DDL for Post Weighting...</div></div>
    <div id="db-support"><h4>2.4 å®¢æœæ”¯æŒç›¸å…³è¡¨</h4><div class="placeholder">SQL DDL for Support Sessions...</div></div>
  </section>

  <section id="backend">
    <h2><span class="material-icons-outlined">dns</span>3. FastAPIåç«¯æ ¸å¿ƒå®ç°</h2>
    <div id="backend-deps">
      <h3>3.1 ä¸»è¦ä¾èµ– (requirements.txt)</h3>
      <div class="code-wrapper"><pre><code class="language-text">fastapi==0.109.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.25
psycopg2-binary==2.9.9
pydantic==2.5.3
pydantic-settings==2.1.0
alembic==1.13.1
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
httpx==0.26.0
redis==5.0.1
python-socketio==5.11.0</code></pre></div>
    </div>
    <div id="backend-services">
      <h3>3.2 æ ¸å¿ƒæœåŠ¡è®¾è®¡</h3>
      <div class="code-wrapper"><pre><code class="language-python"># services/openim_service.py
class OpenIMService:
    async def send_notification(self, user_id: int, message: str)
    async def send_ban_notification(self, user_id: int, reason: str, duration: str)
    async def get_chat_history(self, session_id: str)
    async def send_support_message(self, user_id: int, operator_id: int, message: str)

# services/user_service.py
class UserService:
    async def list_users(self, filters: dict, pagination: dict)
    async def get_user_detail(self, user_id: int)
    async def ban_user(self, user_id: int, ban_data: BanRequest, operator: User)
    async def unban_user(self, user_id: int, operator: User)
    async def search_users(self, query: str, fields: list)

# services/meme_service.py
class MemeService:
    async def list_pending_memes(self, pagination: dict)
    async def approve_meme(self, meme_id: int, operator: User)
    async def reject_meme(self, meme_id: int, reason: str, operator: User)

# services/support_service.py
class SupportService:
    async def get_pending_sessions(self)
    async def assign_session(self, session_id: int, operator_id: int)
    async def close_session(self, session_id: int)
    async def get_quick_replies(self, operator_id: int)
    async def send_message(self, session_id: int, message: str)</code></pre></div>
    </div>
    <div id="backend-ws">
      <h3>3.3 WebSocketå®æ—¶é€šä¿¡</h3>
      <p>ä½¿ç”¨ <code>python-socketio</code> å®ç°å®¢æœå®æ—¶èŠå¤©ï¼Œå…³é”®ç‚¹åŒ…æ‹¬ï¼š</p>
      <ul>
          <li>å®¢æœç«¯ç›‘å¬æ–°æ¶ˆæ¯äº‹ä»¶ã€‚</li>
          <li>å¤šä¸ªè¿è¥äººå‘˜åä½œçš„ä¼šè¯é”å®šæœºåˆ¶ã€‚</li>
          <li>æ¶ˆæ¯å·²è¯»/æœªè¯»çŠ¶æ€çš„å®æ—¶åŒæ­¥ã€‚</li>
      </ul>
    </div>
  </section>

  <section id="frontend">
    <h2><span class="material-icons-outlined">web</span>4. Reactå‰ç«¯æ ¸å¿ƒå®ç°</h2>
    <div id="frontend-stack">
      <h3>4.1 ä¸»è¦æŠ€æœ¯æ ˆ</h3>
      <div class="code-wrapper"><pre><code class="language-json">{
  "dependencies": {
    "react": "^18.2.0",
    "react-router-dom": "^6.21.0",
    "antd": "^5.12.0",
    "@tanstack/react-query": "^5.17.0",
    "zustand": "^4.4.7",
    "axios": "^1.6.5",
    "socket.io-client": "^4.6.1",
    "dayjs": "^1.11.10"
  },
  "devDependencies": {
    "typescript": "^5.3.3",
    "@types/react": "^18.2.48",
    "vite": "^5.0.11"
  }
}</code></pre></div>
    </div>
    <div id="frontend-components">
        <h3>4.2 æ ¸å¿ƒé¡µé¢ç»„ä»¶</h3>
        <ul>
            <li><strong>ç”¨æˆ·ç®¡ç†é¡µé¢:</strong> å¤šå­—æ®µæœç´¢ã€è¡¨æ ¼å±•ç¤ºã€è¯¦æƒ…æŠ½å±‰ã€Ban/Unbanæ“ä½œå¼¹çª—ã€‚</li>
            <li><strong>ç”¨æˆ·è¯¦æƒ…é¡µ:</strong> ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€å°ç¦å†å²ã€Banæ“ä½œè¡¨å•ã€‚</li>
            <li><strong>Memeå®¡æ ¸é¡µ:</strong> Memeåˆ—è¡¨å±•ç¤ºã€Approve/RejectæŒ‰é’®ã€å®¡æ ¸è®°å½•æŸ¥è¯¢ã€‚</li>
            <li><strong>Postæƒé‡ç®¡ç†:</strong> Poståˆ—è¡¨å±•ç¤ºã€æƒé‡è°ƒæ•´ã€åˆ›å»ºPostï¼ˆURLéªŒè¯ï¼‰ã€‚</li>
            <li><strong>å®¢æœæ”¯æŒé¡µ:</strong> å¾…å¤„ç†/å·²å¤„ç†ä¼šè¯åˆ—è¡¨ã€å®æ—¶èŠå¤©çª—å£ã€ä¼šè¯é”å®šã€å¿«æ·å›å¤ã€‚</li>
        </ul>
    </div>
    <div id="frontend-features">
        <h3>4.3 å…³é”®åŠŸèƒ½å®ç°</h3>
        <h4>ä¼šè¯é”å®šæœºåˆ¶</h4>
        <p>ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”ã€‚å½“è¿è¥äººå‘˜æ‰“å¼€ä¸€ä¸ªä¼šè¯æ—¶ï¼Œå‘Rediså†™å…¥ä¸€ä¸ªå¸¦è¶…æ—¶æ—¶é—´çš„é”ã€‚å…¶ä»–è¿è¥äººå‘˜å°è¯•æ‰“å¼€åŒä¸€ä¼šè¯æ—¶ï¼Œå…ˆæ£€æŸ¥é”æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨åˆ™æç¤ºâ€œä¼šè¯æ­£åœ¨ç”±[XXX]å¤„ç†ä¸­â€ã€‚å…³é—­ä¼šè¯æˆ–æµè§ˆå™¨çª—å£æ—¶ä¸»åŠ¨é‡Šæ”¾é”ï¼Œè¶…æ—¶åˆ™è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
        <h4>å®æ—¶æ¶ˆæ¯æ¨é€</h4>
        <p>å‰ç«¯é€šè¿‡Socket.IOå®¢æˆ·ç«¯è¿æ¥åç«¯WebSocketæœåŠ¡ã€‚ç›‘å¬æ–°æ¶ˆæ¯äº‹ä»¶ï¼Œå½“æœ‰æ–°å®¢æœä¼šè¯æˆ–æ–°æ¶ˆæ¯æ—¶ï¼Œå®æ—¶æ›´æ–°å¾…å¤„ç†åˆ—è¡¨å’Œæ¶ˆæ¯è®¡æ•°å™¨ï¼Œå¹¶æ’­æ”¾æç¤ºéŸ³ã€‚</p>
    </div>
  </section>

   <section id="openim">
    <h2><span class="material-icons-outlined">sync_alt</span>5. OpenIMé›†æˆæ–¹æ¡ˆ</h2>
    <h3>5.1 OpenIM APIé›†æˆç‚¹</h3>
    <div class="code-wrapper"><pre><code class="language-json">{
  "// å‘é€é€šçŸ¥æ¶ˆæ¯": "POST /msg/send_msg",
  "send_msg_payload": {
    "sendID": "admin_system",
    "recvID": "user_id",
    "content": { "text": "æ‚¨å·²è¢«å°ç¦ï¼ŒåŸå› ï¼š..." }
  },
  "// è·å–èŠå¤©å†å²": "GET /msg/get_conversation",
  "// å‘é€å®¢æœæ¶ˆæ¯": "POST /msg/send_msg"
}</code></pre></div>
    <h3>5.2 è®¤è¯é›†æˆ</h3>
    <p>åœ¨OpenIMç®¡ç†åå°ä¸ºOPç³»ç»Ÿåˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„ç³»ç»Ÿè´¦å·ï¼Œç”Ÿæˆå¯¹åº”çš„AccessTokenã€‚åç«¯æœåŠ¡åœ¨å¯åŠ¨æ—¶åŠ è½½æ­¤Tokenï¼Œå¹¶å®ç°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æˆ–åœ¨APIè°ƒç”¨å¤±è´¥æ—¶è§¦å‘çš„é€»è¾‘ï¼Œç”¨äºåˆ·æ–°è¿‡æœŸçš„Tokenã€‚</p>
  </section>

  <section id="security">
    <h2><span class="material-icons-outlined">security</span>6. å®‰å…¨ä¸æƒé™æ§åˆ¶</h2>
    <h4>6.1 ç®¡ç†å‘˜è®¤è¯</h4>
    <ul>
        <li><strong>JWT Tokenè®¤è¯:</strong> ç”¨æˆ·ç™»å½•åé¢å‘JWTï¼Œåç»­è¯·æ±‚åœ¨Headerä¸­æºå¸¦ã€‚</li>
        <li><strong>åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ (RBAC):</strong> å®šä¹‰Admin/Operatorç­‰è§’è‰²ï¼Œä¸åŒè§’è‰²æ‹¥æœ‰ä¸åŒAPIçš„è®¿é—®æƒé™ã€‚</li>
        <li><strong>APIçº§åˆ«æƒé™æ ¡éªŒ:</strong> ä½¿ç”¨FastAPIçš„ä¾èµ–æ³¨å…¥ï¼Œåœ¨æ¯ä¸ªéœ€è¦æƒé™çš„è·¯ç”±ä¸Šæ·»åŠ æƒé™æ ¡éªŒä¾èµ–ã€‚</li>
    </ul>
    <h4>6.2 æ“ä½œå®¡è®¡</h4>
    <p>åˆ›å»ºä¸€ä¸ªé€šç”¨çš„è£…é¥°å™¨æˆ–ä¸­é—´ä»¶ï¼Œå¯¹æ‰€æœ‰æ•æ„Ÿçš„å†™æ“ä½œï¼ˆå¦‚å°ç¦ç”¨æˆ·ã€å®¡æ ¸Memeï¼‰è¿›è¡Œæ‹¦æˆªï¼Œå°†æ“ä½œäººã€æ—¶é—´ã€IPåœ°å€ã€è¯·æ±‚å‚æ•°ç­‰ä¿¡æ¯è®°å½•åˆ° <code>audit_logs</code> è¡¨ä¸­ã€‚æä¾›ä¸€ä¸ªå®¡è®¡æ—¥å¿—æŸ¥è¯¢å’Œå¯¼å‡ºåŠŸèƒ½ã€‚</p>
  </section>

  <section id="deployment">
    <h2><span class="material-icons-outlined">cloud_upload</span>7. éƒ¨ç½²å»ºè®®</h2>
    <div class="code-wrapper"><pre><code class="language-yaml"># docker-compose.yml
services:
  backend:
    build: ./backend
    ports: ["8000:8000"]
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/db
      - OPENIM_API_URL=http://openim:10002
      - REDIS_URL=redis://redis:6379
      
  frontend:
    build: ./frontend
    ports: ["3000:80"] # å®é™…éƒ¨ç½²æ—¶ç”¨Nginxä»£ç†
      
  postgres:
    image: postgres:15
    volumes:
      - pgdata:/var/lib/postgresql/data
      
  redis:
    image: redis:7-alpine
volumes:
  pgdata:
</code></pre></div>
  </section>

  <section id="priority">
    <h2><span class="material-icons-outlined">low_priority</span>8. å¼€å‘ä¼˜å…ˆçº§</h2>
    <ol class="timeline">
        <li data-stage="1"><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º</strong><p class="muted">é¡¹ç›®åˆå§‹åŒ–ï¼ˆFastAPI + Reactï¼‰ã€æ•°æ®åº“è¡¨åˆ›å»ºå’Œè¿ç§»ã€ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿã€‚</p></li>
        <li data-stage="2"><strong>ç¬¬äºŒé˜¶æ®µï¼šç”¨æˆ·ç®¡ç†æ¨¡å—</strong><p class="muted">ç”¨æˆ·åˆ—è¡¨å’Œæœç´¢ã€ç”¨æˆ·è¯¦æƒ…ã€Ban/UnbanåŠŸèƒ½ã€OpenIMé€šçŸ¥é›†æˆã€‚</p></li>
        <li data-stage="3"><strong>ç¬¬ä¸‰é˜¶æ®µï¼šå†…å®¹å®¡æ ¸æ¨¡å—</strong><p class="muted">Memeå®¡æ ¸åˆ—è¡¨ã€å®¡æ ¸æ“ä½œå’Œè®°å½•ã€Postæƒé‡ç®¡ç†ã€‚</p></li>
        <li data-stage="4"><strong>ç¬¬å››é˜¶æ®µï¼šå®¢æœæ”¯æŒæ¨¡å—</strong><p class="muted">ä¼šè¯ç®¡ç†ã€å®æ—¶èŠå¤©ï¼ˆWebSocketï¼‰ã€å¿«æ·å›å¤ã€ä¼šè¯é”å®šæœºåˆ¶ã€‚</p></li>
    </ol>
  </section>

  <section id="key-tech">
    <h2><span class="material-icons-outlined">key</span>9. å…³é”®æŠ€æœ¯ç‚¹</h2>
    <ul>
        <li><strong>å¤šè¡¨å…³è”æŸ¥è¯¢ä¼˜åŒ–:</strong> ä½¿ç”¨SQLAlchemyçš„ <code>joinedload</code> æˆ– <code>selectinload</code> é¢„åŠ è½½å…³è”æ•°æ®ï¼Œé¿å…N+1é—®é¢˜ã€‚</li>
        <li><strong>åˆ†é¡µæ€§èƒ½:</strong> å¯¹äºå¯èƒ½æ— é™å¢é•¿çš„åˆ—è¡¨ï¼ˆå¦‚æ—¥å¿—ï¼‰ï¼Œä½¿ç”¨åŸºäºæ¸¸æ ‡çš„åˆ†é¡µï¼ˆcursor-based paginationï¼‰ä»£æ›¿ä¼ ç»Ÿçš„offsetåˆ†é¡µã€‚</li>
        <li><strong>å®æ—¶é€šä¿¡:</strong> Socket.IO é…åˆ Redis Pub/Subï¼Œå®ç°åç«¯æœåŠ¡çš„å¤šå®ä¾‹æ‰©å±•ã€‚</li>
        <li><strong>å¹¶å‘æ§åˆ¶:</strong> ä½¿ç”¨Redisçš„SETNXæˆ–Redlockç®—æ³•å®ç°åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿å®¢æœä¼šè¯åœ¨å¹¶å‘æ“ä½œä¸‹çš„åŸå­æ€§ã€‚</li>
        <li><strong>URLéªŒè¯:</strong> åœ¨åç«¯ä½¿ç”¨Pydanticçš„validatoræˆ–æ­£åˆ™è¡¨è¾¾å¼å¯¹æäº¤çš„Post URLæ ¼å¼è¿›è¡Œä¸¥æ ¼éªŒè¯ã€‚</li>
        <li><strong>å®¡è®¡è¿½è¸ª:</strong> ä½¿ç”¨FastAPIçš„è£…é¥°å™¨æˆ–ä¸­é—´ä»¶æ¨¡å¼ï¼Œä»¥éä¾µå…¥å¼çš„æ–¹å¼ä¸ºæ•æ„Ÿæ“ä½œæ·»åŠ å®¡è®¡æ—¥å¿—è®°å½•ã€‚</li>
    </ul>
  </section>
  
  <div class="action-buttons">
    <a href="javascript:window.print()" class="action-button" title="æ‰“å°/å¯¼å‡º PDF">
        <span class="material-icons-outlined">print</span>
    </a>
    <a href="#" class="action-button" title="å›åˆ°é¡¶éƒ¨">
        <span class="material-icons-outlined">arrow_upward</span>
    </a>
  </div>
</main>

<div class="image-zoom-modal" id="imageZoomModal">
  <span class="close-button" id="closeZoomModal">&times;</span>
  <img src="" alt="Zoomed Image" id="zoomedImage">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Code block copy button ---
    document.querySelectorAll('pre').forEach(pre => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-wrapper';
        if (pre.parentNode.tagName !== 'DIV' || !pre.parentNode.classList.contains('code-wrapper')) {
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(pre);
        }

        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'å¤åˆ¶';
        wrapper.appendChild(button);

        button.addEventListener('click', () => {
            const code = pre.querySelector('code').innerText;
            navigator.clipboard.writeText(code).then(() => {
                button.textContent = 'å·²å¤åˆ¶!';
                setTimeout(() => {
                    button.textContent = 'å¤åˆ¶';
                }, 2000);
            });
        });
    });

    // --- TOC active link highlighting ---
    const tocLinks = document.querySelectorAll('#toc a');
    const sections = Array.from(document.querySelectorAll('section, h3, h4')).filter(el => el.id && el.id !== '');
    
    function highlightToc() {
        let current = '';
        const scrollY = window.pageYOffset;

        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            if (scrollY >= sectionTop - 100) {
                current = section.getAttribute('id');
            }
        });

        tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.hash === '#' + current) {
                link.classList.add('active');
            }
        });
    }
    window.addEventListener('scroll', highlightToc);
    highlightToc();

    // --- Image Zoom Functionality ---
    const modal = document.getElementById('imageZoomModal');
    const modalImg = document.getElementById('zoomedImage');
    const closeBtn = document.getElementById('closeZoomModal');

    document.querySelectorAll('.zoomable-image').forEach(img => {
        img.addEventListener('click', function() {
            modal.classList.add('visible');
            modalImg.src = this.src;
        });
    });

    function closeModal() {
        modal.classList.remove('visible');
    }

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('visible')) {
            closeModal();
        }
    });
});
</script>
</body>
</html>